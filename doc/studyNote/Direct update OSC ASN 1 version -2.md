# Direct update OSC ASN.1 version -2

Start Date: 2024/06/26
Summary: Resolved naming conflicts in OSC's ASN.1 compilation process to successfully encode and decode SIB1 parameters while addressing ongoing issues with PLMN encoding.
Status: Done
Assign: Ming å’šå’š [éŠ˜é´»]

<aside>
ğŸ’¡ 
After regenerating the SIB1-related ASN.1 files, I encountered issues when directly compiling the OSC C code, as it resulted in failures. By examining the compiler error log, I discovered that OSCâ€™s F1AP and E2AP folders had naming conflicts. OSCâ€™s source code in the `codec_utils` directory contains three main folders: RRC, F1AP, and E2AP. The OSC code often uses structs from the RRC folder but modifies their naming conventions by adding an RRC suffix. However, the regenerated SIB1 structs do not have these suffixes, causing conflicts with the F1AP and E2AP folders during compilation. Since the files generated by the compiler are read-only, I had to manually adjust the naming conventions in the E2AP and F1AP folders. For example, I changed file names from `PagingRrc` to `PagingE2AP` and `PagingF1AP` to resolve these conflicts and ensure that the OSC C code compiler could build successfully.

</aside>

<aside>
ğŸ’¡ Regarding this solution, I have some additional thoughts. I also modified the makefile, but I'm not sure if adjusting the makefile could prevent the C code compiler errors caused by naming conflicts. I believe itâ€™s worth a try because it could significantly reduce the amount of modification needed for OSC. However, Iâ€™ve just resolved the issue with decoding MSG2 and am currently addressing the MSG3 problem. I hope to proceed smoothly with MSG4 and then revisit testing these ideas, since the current solution is working.

</aside>

Use nr-rrc-17.3.0.asn1 to build c files and head files

[nr-rrc-17.3.0.asn1](nr-rrc-17.3.0%201.asn1)

Try to fix all of OSC complier build err logâ€¦

- Creat and modify OSC make file, link all of indeed files
- incorrect asn1 build c file or head file name â†’ modify OSC source code (#include name)
- 

- Result

```
-e Compiling [31m[1m /home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/mt/ss_timer.c [m
/home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/mt/ss_msg.c: In function â€˜SPrntMsgâ€™:
/home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/mt/ss_msg.c:5395:9: warning: variable â€˜regâ€™ set but not used [-Wunused-but-set-variable]
 5395 |    Data reg =0;
      |         ^~~
make[1]: Leaving directory '/home/hpe/mwnl-odu-at-oai-based-on-scf/l2/build/odu'
make[1]: Entering directory '/home/hpe/mwnl-odu-at-oai-based-on-scf/l2/build/odu'
-e Compiling [31m[1m /home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/phy_stub//phy_stub_ex_ms.c [m
-e Compiling [31m[1m /home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/phy_stub//phy_stub_msg_hdl.c [m
-e Compiling [31m[1m /home/hpe/mwnl-odu-at-oai-based-on-scf/l2/src/phy_stub//phy_stub_thread_hdl.c [m
-e Creating Archive [31m[1m /home/hpe/mwnl-odu-at-oai-based-on-scf/l2/build/odu/lib/odu/libphystub.a [m
make[1]: Leaving directory '/home/hpe/mwnl-odu-at-oai-based-on-scf/l2/build/odu'
-e ***** BUILD COMPLETE *****
```

[**[Match SIB1] Add searchSpaceType (based on the comparison with OAI SIB1)**](https://github.com/dong881/NTUST-OSC-DU-nFAPI/commit/45539ae5324a7aff42994582e26fe6da5568723f)

[**[Match SIB1] Upgrade ASN.1 RRC version 15_3->17.3.0 (and change Folder name)**](https://github.com/dong881/NTUST-OSC-DU-nFAPI/commit/9a1c5f5fe6cf494887b86b79fe7b59d75eb28f34)

[**[Match SIB1] Because of the version update, a substantial modification of the original makefile and OSC source code's variable names is required to ensure successful compilation.**](https://github.com/dong881/NTUST-OSC-DU-nFAPI/commit/291f349eb0b08324c0196d9ac77e4162b5d1a2e7)

## Issues: PLMN cannot encode

- Follow OAI allocate method and use ASN.1 source function â†’ `ASN_SEQUENCE_ADD`

```cpp
/*
 * SEQUENCE OF is the same as SET OF with a tiny difference:
 * the delete operation preserves the initial order of elements
 * and thus MAY operate in non-constant time.
 */
#define	A_SEQUENCE_OF(type)	A_SET_OF(type)

#define	ASN_SEQUENCE_ADD(headptr, ptr)		\
	asn_sequence_add((headptr), (ptr))

```

- é‡æ–°ç¢ºèªä½å€åˆ†é…æƒ…æ³
- ç¢ºèªASN.1

## Solution: Modify OSC DU source code

ç”±æ–¼é€éOAIçš„ASN.1 struct.ans1 file é‡æ–°ç·¨è­¯ASN.1 c file and head file structï¼Œå› æ­¤å’ŒOSCåŸç”Ÿsource codeæ‰€å®šç¾©çš„struct nameæœ‰è½å·®ï¼Œå› æ­¤æˆ‘æ±ºå®šæ‰‹å‹•ä¿®æ”¹match struct nameï¼Œæ ¹æ“šcompile error logä¸€æ­¥ä¸€æ­¥æ‰¾å‡ºä½å®šç¾©çš„struct nameï¼Œä¸¦æ ¹æ“šæ–°èˆŠç‰ˆå·®ç•°æ¯”å°æ‰¾å‡ºæ–°ç‰ˆæœ¬åç¨±æ›¿æ›ä¸Šå»ï¼Œæœ€çµ‚ï¼Œé †åˆ©compileæˆåŠŸã€‚

ä½†æ˜¯è¡ç”Ÿå‡ºçš„å•é¡Œæ˜¯PLMNç„¡æ³•decodeï¼Œç›®å‰ä»åœ¨ç ”ç©¶ï¼Œä¸¦ä¸”æ‡·ç–‘ï¼š

- E2APè³‡æ–™å¤¾
- F1APè³‡æ–™å¤¾

æœ€çµ‚ï¼Œç¶“æ¸¬è©¦ç™¼ç¾æœ‰é‡è¤‡å®£å‘ŠåŒæª”æ¡ˆåç¨±çš„head fileå› æ­¤å„ªå…ˆä½¿ç”¨äº†E2APèˆ‡F1APè³‡æ–™å¤¾ï¼Œä½†é€™å…©å€‹è³‡æ–™å¤¾å°šæœªå‡ç´šï¼Œå› æ­¤çµæ§‹ç¼ºä¹å®Œæ•´æ€§é€ æˆencodeå¤±æ•—ï¼Œä¿®æ”¹å‘½åæ–¹å¼å¾Œå³å¯é †åˆ©encode and decode SIB1 ASN.1!

â†’ è¡ç”Ÿå•é¡Œï¼šç¶“ä¿®æ”¹ç›®å‰ç„¡æ³•encode MIBï¼Œç›®å‰ä»åœ¨ç ”ç©¶ä¸¦ä¸”æ‡·ç–‘ï¼š

- å› æ›´æ–°çµæ§‹é€ æˆç„¡æ³•encodeï¼Œåƒ…éœ€åšç›¸åŒæ–¹å¼æª¢æŸ¥ï¼Œæ‡‰èƒ½ç›¡å¿«æ‰¾å‡ºåŸå› 

æ ¹æ“šä¹‹å‰æ¯”å°çš„SIB1 æ‰€æœ‰åƒæ•¸ç´€éŒ„ï¼Œå°‡ä¹‹å‰ç‚ºäº†å–®ä¸€æ¸¬è©¦æ‰¾å‡ºå•é¡Œæ‰€revertæ‰çš„commité€ä¸€æ¸¬è©¦è£œå›ä¾†ï¼Œå³å¯è§£é–‹SIB1

â†’ ç›®å‰ç„¡æ³•é€å‡ºMSG1 

æˆåŠŸåƒè€ƒRobertæä¾›çš„OAI ASN.1ç›¸é—œå…§å®¹å°‡OSC çš„ç‰ˆæœ¬å¾rel.15æ›´æ–°åˆ°rel.17
ç›®å‰å¯ä»¥æˆåŠŸencode/decode SIB1çš„searchspace Typeé€™å€‹åƒæ•¸äº†
ä¹Ÿå°±æ˜¯å·²ç¶“è§£æ±ºä¹‹å‰ä¿¡ä¸­æåˆ°çš„å•é¡Œ
æƒ³è«‹æ•™æ•™æˆæˆ‘æ‡‰è©²å‘ä»–å€‘å›å ±è§£æ±ºæ–¹æ¡ˆå—ï¼Ÿ

å•é¡Œæè¿°ï¼š
SIB1 åœ¨åš ASN.1 encodeæ™‚æœƒæ ¹æ“š ç”± ASN1compiler  å°‡ ASN.1 æè¿°æª” ç·¨è­¯æˆ .c .h fileçš„çµæ§‹(struct) åšencode
è€ŒASN1compiler æœ‰è¨±å¤šé–‹æºç‰ˆæœ¬ï¼Œèˆ‰ä¾‹OSC å’Œ OAIå°±ä½¿ç”¨ä¸åŒä¾†æºï¼Œå·®ç•°é»åœ¨æ–¼æ”¯æ´åº¦å¤šå¯¡ (UPERã€PERç­‰ç­‰é¡å‹)
ä¸”ASN.1 æè¿°æª”æ˜¯æ ¹æ“š3GPPå®šç¾© æœ‰ç‰ˆæœ¬å•é¡Œ rel.15, rel.16, rel.17 å› æ­¤ä¸åŒç‰ˆæœ¬æ‰€ç·¨è­¯å‡ºä¾†çš„çµæ§‹ä¹Ÿä¸åŒ
SIB1åœ¨Layer2 encodeä¹‹å‰ï¼Œéœ€è¦æ ¹æ“šé€™äº›struct åç¨±åˆ†é…è¨˜æ†¶é«”ä½å€èˆ‡å€¼ï¼Œæœ€çµ‚æ‰èƒ½é †åˆ©encode

è§£æ±ºæ­¥é©Ÿï¼š

- ä½¿ç”¨OAIæ­£åœ¨ä½¿ç”¨çš„ASN1compiler ä»¥åŠASN.1 æè¿°æª”(rel.17)ï¼Œé‡æ–°å†OSCè³‡æ–™å¤¾å…§ç·¨è­¯
- ç‰ˆæœ¬æ›´æ–°å¾Œçµæ§‹é«”å‘½åå·®å¾ˆå¤šï¼Œå› æ­¤æˆ‘æ ¹æ“šcompile OSC error logé€ä¸€èª¿æ•´OSC source codeæœ‰å¡«å…¥è³‡æ–™çš„éƒ¨åˆ†ï¼Œä¿®æ”¹æ›´æ–°è®Šæ•¸åç¨±
- æœ€å¾Œèª¿æ•´SIB1 åƒæ•¸ åƒè€ƒOAI L2 + L1 çš„è¨­å®š

ç›®å‰æ•´åˆç‹€æ³æ˜¯å¯ä»¥æˆåŠŸå‚³é€
ä¸‹è¡Œï¼šMIBã€DCIã€SIB1
ä¸Šè¡Œï¼šRA (åªæœ‰çœ‹åˆ°UEé€åˆ°OAI PNFï¼Œä¸¦æœªé€åˆ°OSC DU High)

ä½†æ˜¯æ ¹æ“šOAI L2 + L1çš„ç¯„ä¾‹ä¾†åˆ†æï¼ŒOAI PNFæ˜¯è¦å¯ä»¥é †åˆ©å‚³é€çš„ï¼Œå› æ­¤ä¸‹ä¸€æ­¥æˆ‘æœƒç¹¼çºŒæª¢æŸ¥æ˜¯ç”šéº¼åŸå› é€ æˆ