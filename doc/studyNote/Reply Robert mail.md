# Reply Robert mail

Start Date: 2024/10/31
Summary: Reply to Robert's email regarding F1AP version issues, ASN1c decoding, and ongoing internal testing updates.
Status: Done
Assign: Ming 咚咚 [銘鴻]
Tags: mail
Finish Date: 2024/11/01
SUM: 🗓️ Days Spent to Complete: 1

[**Original**](Original%20131100983143801fbce5d6c3eb667eba.md)

### Summary

1. Nokia requested an ASN1c diff comparison and provided a test file.
2. OSC requires community consensus for ASN1c changes; Ankit suggests waiting for Nokia’s compiler fix.
3. Using mouse07410's ASN1c version requires modifications to OSC's code due to variable name mismatches, causing compilation issues.
4. Rebuilding F1AP and E2AP encountered `unknown type name` errors.
5. Started internal testing with SIB1 to address encoding issues for SIB1 and F1AP ASN1.
6. Comparison with OAI Layer2 indicates potential issues with CellGroupConfig decoding.

---

### Robert's Response

### On F1AP Version

Which version of F1AP are you using? In the OAI build directory, the file `openair2/F1AP/MESSAGES/F1AP_ProtocolIE-SingleContainer.h` contains these types. The first type, `F1AP_ProtocolIE-Field.h`, is in `F1AP_ProtocolIE-Field.h` and is included directly at the top. I'll attach both files as generated by OAI in the development branch. Could you send your files as well? Note the compilation information at the top of the files.

### CellGroupConfig Decoding Issue

Regarding the CellGroupConfig decoding issue, this doesn't necessarily mean it failed to decode. The segmentation fault (segfault) occurs because something isn’t set as expected. It might simply be a missing configuration in the CellGroupConfig (which OAI UE seems to assume is present), but this doesn't necessarily indicate a decoding failure or a bug on either side.

The CellGroupConfig decoding problem generally shows up when `uper_decode()` fails—not as a random segv error. You may have jumped to a conclusion too quickly here. The question now is why the segv occurred. Please investigate this and provide a full backtrace.

Command:

```bash
gdb> bt full

```

```bash
[MAC]   received TA command 31
[PHY]   RAR-Msg2 decoded
[NR_MAC]   [RAPROC][152.19] RA-Msg3 transmitted
[MAC]   [UE 0]Frame 153 Contention resolution identity: 0x14ce0877fb66 Terminating RA procedure
[MAC]   [UE 0][153.15][RAPROC] RA procedure succeeded. CB-RA: Contention Resolution is successful.
[NR_RRC]   [UE0][RAPROC] Logical Channel DL-CCCH (SRB0), Received NR_RRCSetup
[RLC]   Added srb 1 to UE 0
[MAC]   Applying CellGroupConfig from gNodeB
[NR_RRC]   State = NR_RRC_CONNECTED
[NR_RRC]   [UE 0][RAPROC] Logical Channel UL-DCCH (SRB1), Generating RRCSetupComplete (bytes33)

Thread 9 "Tpool7_-1" received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x7ffff2a00640 (LWP 3181723)]
nr_update_sr (mac=0x7fffef000010) at /home/hpe/openairinterface5g/openair2/LAYER2/NR_MAC_UE/nr_ue_scheduler.c:1184
1184          if (check_pucchres_for_pending_SR(pucch_Config, lc_info->sr_id)) {
(gdb) bt full
#0  nr_update_sr (mac=0x7fffef000010)
    at /home/hpe/openairinterface5g/openair2/LAYER2/NR_MAC_UE/nr_ue_scheduler.c:1184
        current_UL_BWP = 0x0
        pucch_Config = 0x0
        sr = 0x7fffef325330
        sched_info = 0x7fffef324df0
        data_avail = <optimized out>
        lc_info = 0x7fffc8008080
        sched_info = <optimized out>
        data_avail = <optimized out>
        __FUNCTION__ = "nr_update_sr"
        lc_info = <optimized out>
        i = <optimized out>
        i = <optimized out>
        sr = <optimized out>
        T_LOCAL_buf = <optimized out>
        T_LOCAL_size = <optimized out>
        T_LOCAL_slot = <optimized out>
        T_LOCAL_busy = <optimized out>
        T_HEADER_time = <optimized out>
        T_PUT_var = <optimized out>
        T_PUT_len = <optimized out>
        tmp = <optimized out>
        dummy = <optimized out>
        T_LOCAL_buf = <optimized out>
        T_LOCAL_size = <optimized out>
        T_LOCAL_slot = <optimized out>
        T_LOCAL_busy = <optimized out>
        T_HEADER_time = <optimized out>
        T_PUT_var = <optimized out>
        T_PUT_len = <optimized out>
        sr = <optimized out>
        current_UL_BWP = <optimized out>
        pucch_Config = <optimized out>
        T_LOCAL_buf = <optimized out>
        T_LOCAL_size = <optimized out>
        T_LOCAL_slot = <optimized out>
        T_LOCAL_busy = <optimized out>
        T_HEADER_time = <optimized out>
        T_PUT_var = <optimized out>
        T_PUT_len = <optimized out>
#1  nr_ue_ul_scheduler (mac=mac@entry=0x7fffef000010, 
    ul_info=ul_info@entry=0x7ffff29ff440)
    at /home/hpe/openairinterface5g/openair2/LAYER2/NR_MAC_UE/nr_ue_scheduler.c:1358
        cc_id = 0
        frame_tx = 153
        slot_tx = 19
        gNB_index = 0
        ra = 0x7fffef323560
--Type <RET> for more, q to quit, c to continue without paging--
```

## About F1AP Version

I currently cannot determine which version of F1AP they are using from the build log, so I will inquire further.

However, I can provide the files they gave me along with the information mentioned at the top of their compiled output.

Please refer to the description below, as well as the attached OSC-provided F1AP struct definition file.

[F1.asn1](F1%201.asn1)

```bash
/*
* Generated by asn1c-0.9.29 (http://lionet.info/asn1c)
* From ASN.1 module "F1AP-IEs"
*    found in "../F1.asn1"
*    `asn1c -D ../F1_output/ -fcompound-names -fno-include-deps -findirect-choice -gen-PER`
*/
```

## About CellGroupConfig Decoding

IssueThe segmentation fault occurs in the nr_update_sr function due to a null pointer dereference of pucch_Config, indicating potential initialization issues or memory management errors.

refer to the attached UE-BT.log for the complete UE log and backtrace log.

[UE-BT.log](UE-BT.log)